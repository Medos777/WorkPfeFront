"use strict";(self.webpackChunkpfefront=self.webpackChunkpfefront||[]).push([[754],{82754:(e,t,s)=>{s.r(t),s.d(t,{default:()=>P});var o=s(89379),a=s(65043),r=s(26240),i=s(85442),l=s(90035),c=s(26600),n=s(35316),d=s(14194),u=s(68903),p=s(67784),m=s(53193),h=s(79190),g=s(69285),A=s(32143),j=s(7353),x=s(43845),v=s(94496),y=s(81673),f=s(29347),b=s(42518),w=s(81637),C=s(98008),D=s(11046),k=s(94160),E=s(70579);const P=e=>{let{open:t,onClose:s,projectId:P,epic:I}=e;const S=(0,r.A)(),F=(0,i.A)(S.breakpoints.down("sm")),[W,z]=(0,a.useState)(!1),[T,L]=(0,a.useState)(""),[B,O]=(0,a.useState)(""),[_,N]=(0,a.useState)([]),[q,H]=(0,a.useState)([]),[M,U]=(0,a.useState)({name:"",description:"",project:P||"",status:"to do",priority:"medium",startDate:"",dueDate:"",color:"#0052CC",labels:[],watchers:[],issues:[]});(0,a.useEffect)((()=>{(async()=>{try{const[e,t]=await Promise.all([D.A.getAll(),k.A.getAll()]);N(e.data),H(t.data)}catch(e){console.error("Error loading data:",e),L("Failed to load required data")}})()}),[]),(0,a.useEffect)((()=>{U(I?{name:I.name||"",description:I.description||"",project:I.project||P||"",status:I.status||"to do",priority:I.priority||"medium",startDate:I.startDate?new Date(I.startDate).toISOString().split("T")[0]:"",dueDate:I.dueDate?new Date(I.dueDate).toISOString().split("T")[0]:"",color:I.color||"#0052CC",labels:I.labels||[],watchers:I.watchers||[],issues:I.issues||[]}:{name:"",description:"",project:P||"",status:"to do",priority:"medium",startDate:"",dueDate:"",color:"#0052CC",labels:[],watchers:[],issues:[]})}),[I,P]);const R=e=>{const{name:t,value:s}=e.target;if(console.log("Handle change:",t,s),"issues"===t)console.log("Issues selected:",s),U((e=>{const t=(0,o.A)((0,o.A)({},e),{},{issues:Array.isArray(s)?s:[]});return console.log("New epic data after issues change:",t),t}));else{const e="project"===t?s||"":""===s?void 0:s;U((s=>(0,o.A)((0,o.A)({},s),{},{[t]:e})))}},K=()=>{U({name:"",description:"",project:P||"",status:"to do",priority:"medium",startDate:"",dueDate:"",color:"#0052CC",labels:[],watchers:[],issues:[]}),L(""),O(""),s(!1)},V=e=>{switch(e){case"to do":default:return{bg:"#E3F2FD",color:"#1976D2"};case"in progress":return{bg:"#F7DC6F",color:"#FFD700"};case"done":return{bg:"#C6F4D6",color:"#2E865F"}}},G=e=>{switch(e){case"highest":return"#FF0000";case"high":return"#FFA07A";case"medium":default:return"#FFFF00";case"low":return"#32CD32";case"lowest":return"#008000"}};return(0,E.jsxs)(l.A,{open:t,onClose:K,fullScreen:F,maxWidth:"sm",fullWidth:!0,children:[(0,E.jsx)(c.A,{children:I?"Edit Epic":"Create New Epic"}),(0,E.jsxs)("form",{onSubmit:async e=>{var t;e.preventDefault(),z(!0),L(""),O("");const o=localStorage.getItem("userId");if(!o)return L("User not authenticated"),void z(!1);if(null===(t=M.name)||void 0===t||!t.trim())return L("Epic name is required"),void z(!1);try{var a,r,i,l,c,n,d,u;const e={name:M.name.trim(),description:null===(a=M.description)||void 0===a?void 0:a.trim(),status:(null===(r=M.status)||void 0===r?void 0:r.toLowerCase())||"to do",priority:(null===(i=M.priority)||void 0===i?void 0:i.toLowerCase())||"medium",owner:o,project:M.project||P||null,startDate:M.startDate||void 0,dueDate:M.dueDate||void 0,color:M.color||"#0052CC",labels:(null===(l=M.labels)||void 0===l?void 0:l.length)>0?M.labels:void 0,watchers:(null===(c=M.watchers)||void 0===c?void 0:c.length)>0?M.watchers:void 0,issues:(null===(n=M.issues)||void 0===n?void 0:n.length)>0?M.issues:void 0};let t;if(Object.keys(e).forEach((t=>{void 0===e[t]&&delete e[t]})),console.log("Submitting epic data:",e),I?(t=await C.A.update(I._id,e),console.log("Epic updated:",t.data),O("Epic updated successfully!")):(t=await C.A.create(e),console.log("Epic created:",t.data),O("Epic created successfully!")),!I&&null!==(d=t.data)&&void 0!==d&&d._id&&(null===(u=M.issues)||void 0===u?void 0:u.length)>0)try{await Promise.all(M.issues.map((e=>k.A.update(e,{epic:t.data._id})))),console.log("Issues updated successfully")}catch(h){console.error("Error updating issues:",h)}setTimeout((()=>{z(!1),s(!0)}),1e3)}catch(g){var p,m;console.error("Error submitting epic:",g);const e=(null===(p=g.response)||void 0===p||null===(m=p.data)||void 0===m?void 0:m.message)||"Failed to save epic. Please check all required fields.";L(e),z(!1)}},children:[(0,E.jsxs)(n.A,{children:[T&&(0,E.jsx)(d.A,{severity:"error",sx:{mb:2},children:T}),B&&(0,E.jsx)(d.A,{severity:"success",sx:{mb:2},children:B}),(0,E.jsxs)(u.Ay,{container:!0,spacing:2,children:[(0,E.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,E.jsx)(p.A,{name:"key",label:"Epic Key (Optional)",value:M.key,onChange:R,fullWidth:!0,size:F?"small":"medium",helperText:"Unique identifier for project-linked epics"})}),(0,E.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,E.jsx)(p.A,{name:"name",label:"Epic Name",value:M.name,onChange:R,fullWidth:!0,required:!0,size:F?"small":"medium"})}),(0,E.jsx)(u.Ay,{item:!0,xs:12,children:(0,E.jsx)(p.A,{name:"description",label:"Description",value:M.description,onChange:R,fullWidth:!0,multiline:!0,rows:3,size:F?"small":"medium"})}),(0,E.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,E.jsxs)(m.A,{fullWidth:!0,size:F?"small":"medium",children:[(0,E.jsx)(h.A,{children:"Project (Optional)"}),(0,E.jsxs)(g.A,{name:"project",value:M.project||"",onChange:R,label:"Project (Optional)",children:[(0,E.jsx)(A.A,{value:"",children:(0,E.jsx)("em",{children:"None"})}),_.map((e=>(0,E.jsx)(A.A,{value:e._id,children:e.projectName},e._id)))]})]})}),(0,E.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,E.jsxs)(m.A,{fullWidth:!0,size:F?"small":"medium",children:[(0,E.jsx)(h.A,{children:"Status"}),(0,E.jsxs)(g.A,{name:"status",value:M.status,onChange:R,label:"Status",children:[(0,E.jsx)(A.A,{value:"to do",children:"To Do"}),(0,E.jsx)(A.A,{value:"in progress",children:"In Progress"}),(0,E.jsx)(A.A,{value:"done",children:"Done"})]})]})}),(0,E.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,E.jsxs)(m.A,{fullWidth:!0,size:F?"small":"medium",children:[(0,E.jsx)(h.A,{children:"Priority"}),(0,E.jsxs)(g.A,{name:"priority",value:M.priority,onChange:R,label:"Priority",children:[(0,E.jsx)(A.A,{value:"highest",children:"Highest"}),(0,E.jsx)(A.A,{value:"high",children:"High"}),(0,E.jsx)(A.A,{value:"medium",children:"Medium"}),(0,E.jsx)(A.A,{value:"low",children:"Low"}),(0,E.jsx)(A.A,{value:"lowest",children:"Lowest"})]})]})}),(0,E.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,E.jsx)(p.A,{name:"color",label:"Epic Color",type:"color",value:M.color,onChange:R,fullWidth:!0,size:F?"small":"medium",InputLabelProps:{shrink:!0}})}),(0,E.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,E.jsx)(p.A,{name:"startDate",label:"Start Date",type:"date",value:M.startDate,onChange:R,fullWidth:!0,size:F?"small":"medium",InputLabelProps:{shrink:!0}})}),(0,E.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,E.jsx)(p.A,{name:"dueDate",label:"Due Date",type:"date",value:M.dueDate,onChange:R,fullWidth:!0,size:F?"small":"medium",InputLabelProps:{shrink:!0}})}),(0,E.jsx)(u.Ay,{item:!0,xs:12,children:(0,E.jsxs)(m.A,{fullWidth:!0,size:F?"small":"medium",children:[(0,E.jsx)(h.A,{id:"issues-label",children:"Issues"}),(0,E.jsx)(g.A,{labelId:"issues-label",name:"issues",multiple:!0,value:M.issues||[],onChange:R,label:"Issues",renderValue:e=>(0,E.jsx)(j.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((e=>{const t=q.find((t=>t._id===e));return(0,E.jsx)(x.A,{label:t?"".concat(t.key," - ").concat(t.title):e,sx:{backgroundColor:t?V(t.status).bg:"#E3F2FD",color:t?V(t.status).color:"#1976D2",fontWeight:500}},e)}))}),MenuProps:{PaperProps:{style:{maxHeight:300}}},children:q&&q.length>0?q.map((e=>(0,E.jsxs)(A.A,{value:e._id,sx:{display:"flex",justifyContent:"space-between",gap:1,py:1},children:[(0,E.jsxs)(j.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,E.jsx)(v.A,{variant:"body2",sx:{fontWeight:600,color:"primary.main",minWidth:"80px"},children:e.key}),(0,E.jsx)(v.A,{variant:"body2",children:e.title})]}),(0,E.jsxs)(j.A,{sx:{display:"flex",gap:1,flexShrink:0},children:[(0,E.jsx)(x.A,{label:e.status,size:"small",sx:{backgroundColor:V(e.status).bg,color:V(e.status).color,height:24}}),(0,E.jsx)(x.A,{label:e.priority,size:"small",sx:{backgroundColor:"white",color:G(e.priority),border:1,borderColor:G(e.priority),height:24}})]})]},e._id))):(0,E.jsx)(A.A,{disabled:!0,children:"No issues available"})}),T&&T.includes("issues")&&(0,E.jsx)(y.A,{error:!0,children:T})]})})]})]}),(0,E.jsxs)(f.A,{sx:{p:S.spacing(2)},children:[(0,E.jsx)(b.A,{onClick:K,size:F?"small":"medium",fullWidth:F,children:"Cancel"}),(0,E.jsx)(b.A,{type:"submit",variant:"contained",size:F?"small":"medium",fullWidth:F,disabled:W,sx:{backgroundColor:"#0052CC","&:hover":{backgroundColor:"#0747A6"}},children:W?(0,E.jsx)(w.A,{size:24}):I?"Update Epic":"Create Epic"})]})]})]})}},98008:(e,t,s)=>{s.d(t,{A:()=>r});var o=s(50214);const a=e=>{var t,s,o;const a={name:null===(t=e.name)||void 0===t?void 0:t.trim(),description:null===(s=e.description)||void 0===s?void 0:s.trim(),status:(null===(o=e.status)||void 0===o?void 0:o.toLowerCase())||"to do",priority:(e.priority||"medium").toLowerCase(),startDate:e.startDate||void 0,dueDate:e.dueDate||void 0,owner:e.owner||localStorage.getItem("userId"),watchers:e.watchers||[]};return void 0!==e.project&&(a.project=e.project||null),Object.keys(a).forEach((e=>{void 0===a[e]&&delete a[e]})),console.log("Original epic data:",e),console.log("Transformed epic data:",a),a},r={getAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o.A.get("/epics",{params:e})},getById:e=>o.A.get("/epics/".concat(e)),getByProject:e=>o.A.get("/epics/project/".concat(e)),create:e=>{const t=a(e);return o.A.post("/epics",t)},update:(e,t)=>{const s=a(t);return console.log("Transformed update data:",s),o.A.put("/epics/".concat(e),s)},remove:e=>o.A.delete("/epics/".concat(e)),updateProgress:e=>o.A.post("/epics/".concat(e,"/progress")),addWatcher:(e,t)=>o.A.post("/epics/".concat(e,"/watchers"),{userId:t}),removeWatcher:(e,t)=>o.A.delete("/epics/".concat(e,"/watchers"),{data:{userId:t}}),updateEpicStatus:(e,t)=>{const s=a(t);return o.A.put("/epics/".concat(e),s)}}},94160:(e,t,s)=>{s.d(t,{A:()=>a});var o=s(50214);const a={getAll:()=>o.A.get("/issues"),getById:e=>o.A.get("/issues/".concat(e)),getByProject:e=>o.A.get("/issues/project/".concat(e)),getByEpic:e=>o.A.get("/issues/epic/".concat(e)),getBySprint:e=>o.A.get("/issues/sprint/".concat(e)),create:e=>o.A.post("/issues",e),update:(e,t)=>{const s=(e=>{var t,s,o;const a={title:null===(t=e.title)||void 0===t?void 0:t.trim(),description:null===(s=e.description)||void 0===s?void 0:s.trim(),status:(null===(o=e.status)||void 0===o?void 0:o.toLowerCase())||"to do",priority:(e.priority||"medium").toLowerCase(),startDate:e.startDate||void 0,dueDate:e.dueDate||void 0,owner:e.owner||localStorage.getItem("userId"),assignee:e.assignee||null,watchers:e.watchers||[]};return void 0!==e.project&&(a.project=e.project||null),Object.keys(a).forEach((e=>{void 0===a[e]&&delete a[e]})),console.log("Original issue data:",e),console.log("Transformed issue data:",a),a})(t);return console.log("Transformed update data:",s),o.A.put("/issues/".concat(e),s)},remove:e=>o.A.delete("/issues/".concat(e)),addComment:(e,t)=>o.A.post("/issues/".concat(e,"/comments"),t),addAttachment:(e,t)=>{const s=new FormData;return s.append("attachment",t),o.A.post("/issues/".concat(e,"/attachments"),s,{headers:{"Content-Type":"multipart/form-data"}})},updateTimeTracking:(e,t)=>o.A.post("/issues/".concat(e,"/timetracking"),t)}},11046:(e,t,s)=>{s.d(t,{A:()=>a});var o=s(50214);const a={getAll:()=>o.A.get("/projects"),get:e=>o.A.get("/projects/".concat(e)),create:e=>o.A.post("/projects",e),update:(e,t)=>o.A.put("/projects/".concat(e),t),remove:e=>o.A.delete("/projects/".concat(e)),removeAll:()=>o.A.delete("/projects"),findByTitle:e=>o.A.get("/projects?title=".concat(e)),getProjectProgress:e=>o.A.get("/projects/".concat(e,"/progress")),getBudgetAnalytics:e=>o.A.get("/projects/".concat(e,"/budget-analytics")),getTeamPerformance:e=>o.A.get("/projects/".concat(e,"/team-performance")),searchProjects:e=>o.A.post("/projects/search",e),getProjectMessages:e=>o.A.get("/projects/".concat(e,"/messages")),sendProjectMessage:(e,t)=>o.A.post("/projects/".concat(e,"/messages"),t),exportProjectReport:(e,t)=>o.A.get("/projects/".concat(e,"/export/").concat(t)),scheduleReport:(e,t)=>o.A.post("/projects/".concat(e,"/schedule-report"),t),getProjectAnalytics:e=>o.A.get("/projects/".concat(e,"/analytics")),getProjectById:e=>o.A.get("/projects/id/".concat(e)),findByTeams:e=>o.A.get("/projects/teams/".concat(e))}}}]);
//# sourceMappingURL=754.ec53e6ad.chunk.js.map