"use strict";(self.webpackChunkpfefront=self.webpackChunkpfefront||[]).push([[57],{2057:(e,t,s)=>{s.r(t),s.d(t,{default:()=>te});var l=s(89379),r=s(65043),i=s(7353),a=s(94496),o=s(43845),n=s(18483),c=s(81045),d=s(42518),u=s(68903),h=s(67784),A=s(53193),x=s(79190),p=s(69285),g=s(32143),j=s(79650),m=s(71806),y=s(84882),v=s(28076),f=s(10039),b=s(73460),w=s(81637),S=s(17392),P=s(89735),C=s(688),I=s(2050),k=s(15337),D=s(70141),T=s(79484),_=s(58558),E=s(83560),R=s(51387),U=s(19581),z=s(94160),B=s(11046),L=s(71330),M=s(73216),W=s(42734),O=s(35964),H=s(30335),N=s(67537),F=s(31546),G=s(70579);const Y={highest:{color:"error",icon:"\u26a1",label:"Highest"},high:{color:"warning",icon:"\u2191",label:"High"},medium:{color:"info",icon:"\u2192",label:"Medium"},low:{color:"success",icon:"\u2193",label:"Low"},lowest:{color:"default",icon:"\u2193\u2193",label:"Lowest"}},K={story:{color:"primary",icon:(0,G.jsx)(k.A,{}),label:"Story"},task:{color:"info",icon:(0,G.jsx)(k.A,{}),label:"Task"},bug:{color:"error",icon:(0,G.jsx)(k.A,{}),label:"Bug"},epic:{color:"secondary",icon:(0,G.jsx)(k.A,{}),label:"Epic"}},Q="todo",V="inprogress",X="done",Z={[Q]:"To Do",[V]:"In Progress",[X]:"Done"},q={[Q]:"#e5e7eb",[V]:"#fef3c7",[X]:"#d1fae5"},J={[Q]:"\ud83d\udccb",[V]:"\ud83d\udd04",[X]:"\u2705"},$=["#1976d2","#dc004e","#388e3c","#f57c00","#6d1b7b"],ee=e=>{const t=e.charCodeAt(0)%$.length;return $[t]},te=()=>{const{projectId:e}=(0,M.g)(),[t,s]=(0,r.useState)([]),[$,te]=(0,r.useState)([]),[se,le]=(0,r.useState)(!0),[re,ie]=(0,r.useState)(0),[ae,oe]=(0,r.useState)(""),[ne,ce]=(0,r.useState)("all"),[de,ue]=(0,r.useState)("all"),[he,Ae]=(0,r.useState)(e||"all"),[xe,pe]=(0,r.useState)("all"),[ge,je]=(0,r.useState)([]),[me,ye]=(0,r.useState)([]),[ve,fe]=(0,r.useState)([]),[be,we]=(0,r.useState)(null),[Se,Pe]=(0,r.useState)(null),Ce=(0,M.Zp)(),[Ie,ke]=(0,r.useState)("table"),De=localStorage.getItem("role"),Te=localStorage.getItem("userId"),_e="developer"===De,Ee=e=>ve.find((t=>t._id===e)),Re=e=>{let t=e;_e&&(t=e.filter((e=>e.assignee===Te)));return t.filter((e=>{const t="all"===he||e.projectId===he,s="all"===xe||e.epicId===xe,l="all"===de||e.type===de,r="all"===ne||e.status===ne,i=!ae||e.title.toLowerCase().includes(ae.toLowerCase())||e.description.toLowerCase().includes(ae.toLowerCase());return t&&s&&l&&r&&i}))},Ue=async(e,r)=>{try{const i=t.find((t=>t._id===e));if(!i)return;document.cookie="issue_status_".concat(e,"=").concat(r,"; max-age=604800; path=/"),s((t=>t.map((t=>t._id===e?(0,l.A)((0,l.A)({},t),{},{status:r}):t))));const a={title:i.title,description:i.description,status:r,priority:i.priority,projectId:i.projectId,epicId:i.epicId,assignee:i.assignee,reporter:i.reporter,owner:localStorage.getItem("userId"),storyPoints:i.storyPoints,dueDate:i.dueDate};await z.A.update(e,a),console.log("Status updated successfully in backend and stored in cookies")}catch(i){console.error("Error updating status:",i)}};(0,r.useEffect)((()=>{(async()=>{le(!0);try{const[e,t,l]=await Promise.all([B.A.getAll(),z.A.getAll(),L.A.getAll()]);console.log("Fetched Issues:",t.data),console.log("Fetched Users:",l.data),fe(l.data),je(e.data),s(t.data);const r=t.data.filter((e=>"epic"===e.type));ye(r);const i=Re(t.data);te(i)}catch(e){console.error("Error fetching data:",e)}finally{le(!1)}})()}),[]),(0,r.useEffect)((()=>{if(t.length>0){const e=Re(t);te(e)}}),[he,xe,de,ne,ae,t]);const ze=e=>{var t;let{issue:s}=e;const[{isDragging:l},r]=(0,W.i)({type:"issue",item:{id:s._id,currentStatus:s.status},collect:e=>({isDragging:e.isDragging()})}),d=ve.find((e=>e._id===s.assignee));return(0,G.jsxs)(i.A,{ref:r,sx:{opacity:l?.4:1,cursor:"move",bgcolor:"background.paper",p:2,m:1,borderRadius:2,boxShadow:"0 2px 4px rgba(0,0,0,0.1)",transition:"all 0.2s ease","&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.15)",transform:"translateY(-2px)"},display:"flex",flexDirection:"column",gap:1},children:[(0,G.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,G.jsx)(a.A,{variant:"caption",color:"text.secondary",children:s.key}),(0,G.jsx)(o.A,{size:"small",label:s.priority,color:(null===(t=Y[s.priority.toLowerCase()])||void 0===t?void 0:t.color)||"default",sx:{height:24}})]}),(0,G.jsx)(a.A,{variant:"subtitle1",sx:{fontWeight:"medium",mb:1},children:s.title}),(0,G.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:"auto"},children:[d?(0,G.jsx)(n.A,{title:d.username,children:(0,G.jsx)(c.A,{sx:{width:24,height:24,bgcolor:ee(d.username),fontSize:"0.875rem"},children:d.username.charAt(0).toUpperCase()})}):(0,G.jsx)(c.A,{sx:{width:24,height:24,bgcolor:"grey.300"},children:"-"}),s.storyPoints&&(0,G.jsx)(o.A,{size:"small",label:"".concat(s.storyPoints," pts"),variant:"outlined",sx:{height:24}})]})]})},Be=e=>{let{status:t,issues:s}=e;const[{isOver:l},r]=(0,O.H)({accept:"issue",drop:e=>{e.currentStatus!==t&&Ue(e.id,t)},collect:e=>({isOver:e.isOver()})});return(0,G.jsxs)(i.A,{ref:r,sx:{width:"33%",minHeight:500,p:2,bgcolor:l?(0,F.X4)(q[t],.7):q[t],borderRadius:2,transition:"all 0.2s",display:"flex",flexDirection:"column",gap:1},children:[(0,G.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:2,px:2,py:1,bgcolor:"background.paper",borderRadius:1,boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,G.jsxs)(a.A,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,color:"text.primary",fontWeight:"medium"},children:[J[t]," ",Z[t]]}),(0,G.jsx)(o.A,{size:"small",label:s.length,color:"primary",variant:"outlined",sx:{ml:"auto"}})]}),(0,G.jsx)(i.A,{sx:{bgcolor:"background.paper",borderRadius:2,minHeight:400,p:1,overflowY:"auto"},children:s.map((e=>(0,G.jsx)(ze,{issue:e},e._id)))})]})};return(0,G.jsxs)(i.A,{sx:{width:"100%",p:3},children:[(0,G.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,G.jsx)(a.A,{variant:"h4",component:"h1",children:"Issues"}),!_e&&(0,G.jsx)(d.A,{variant:"contained",startIcon:(0,G.jsx)(D.A,{}),onClick:()=>Ce(e?"/projects/".concat(e,"/issues/add"):"/issues/add"),children:"Add Issue"})]}),(0,G.jsxs)(u.Ay,{container:!0,spacing:2,sx:{mb:3},children:[(0,G.jsx)(u.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,G.jsx)(h.A,{fullWidth:!0,label:"Search",value:ae,onChange:e=>oe(e.target.value),InputProps:{startAdornment:(0,G.jsx)(T.A,{sx:{mr:1}})}})}),(0,G.jsx)(u.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,G.jsxs)(A.A,{fullWidth:!0,children:[(0,G.jsx)(x.A,{children:"Project"}),(0,G.jsxs)(p.A,{value:he,onChange:e=>{Ae(e.target.value),pe("all")},label:"Project",children:[(0,G.jsx)(g.A,{value:"all",children:"All Projects"}),ge.map((e=>(0,G.jsx)(g.A,{value:e._id,children:e.name},e._id)))]})]})}),(0,G.jsx)(u.Ay,{item:!0,xs:12,sm:6,md:2,children:(0,G.jsxs)(A.A,{fullWidth:!0,children:[(0,G.jsx)(x.A,{children:"Epic"}),(0,G.jsxs)(p.A,{value:xe,onChange:e=>{pe(e.target.value),Ae("all")},label:"Epic",disabled:"all"===he,children:[(0,G.jsx)(g.A,{value:"all",children:"All Epics"}),me.map((e=>(0,G.jsx)(g.A,{value:e._id,children:e.title},e._id)))]})]})}),(0,G.jsx)(u.Ay,{item:!0,xs:12,sm:6,md:2,children:(0,G.jsxs)(A.A,{fullWidth:!0,children:[(0,G.jsx)(x.A,{children:"Type"}),(0,G.jsxs)(p.A,{value:de,onChange:e=>ue(e.target.value),label:"Type",children:[(0,G.jsx)(g.A,{value:"all",children:"All Types"}),Object.entries(K).map((e=>{let[t,s]=e;return(0,G.jsx)(g.A,{value:t,children:s.label},t)}))]})]})}),(0,G.jsx)(u.Ay,{item:!0,xs:12,sm:6,md:2,children:(0,G.jsxs)(A.A,{fullWidth:!0,children:[(0,G.jsx)(x.A,{children:"Status"}),(0,G.jsxs)(p.A,{value:ne,onChange:e=>ce(e.target.value),label:"Status",children:[(0,G.jsx)(g.A,{value:"all",children:"All Statuses"}),(0,G.jsx)(g.A,{value:Q,children:Z[Q]}),(0,G.jsx)(g.A,{value:V,children:Z[V]}),(0,G.jsx)(g.A,{value:X,children:Z[X]})]})]})})]}),(0,G.jsxs)(d.A,{variant:"contained",onClick:()=>{ke((e=>"table"===e?"card":"table"))},children:["Toggle to ","table"===Ie?"Card":"Table"," View"]}),"table"===Ie?(0,G.jsx)(j.A,{children:(0,G.jsxs)(m.A,{sx:{minWidth:750},"aria-labelledby":"tableTitle",children:[(0,G.jsx)(y.A,{children:(0,G.jsxs)(v.A,{children:[(0,G.jsx)(f.A,{children:"Key"}),(0,G.jsx)(f.A,{children:"Type"}),(0,G.jsx)(f.A,{children:"Title"}),(0,G.jsx)(f.A,{children:"Priority"}),(0,G.jsx)(f.A,{children:"Status"}),(0,G.jsx)(f.A,{children:"Assignee"}),(0,G.jsx)(f.A,{children:"Reporter"}),(0,G.jsx)(f.A,{children:"Story Points"}),(0,G.jsx)(f.A,{children:"Due Date"}),(0,G.jsx)(f.A,{children:"Created"}),(0,G.jsx)(f.A,{children:"Actions"})]})}),(0,G.jsx)(b.A,{children:se?(0,G.jsx)(v.A,{children:(0,G.jsx)(f.A,{colSpan:12,align:"center",children:(0,G.jsx)(w.A,{})})}):0===$.length?(0,G.jsx)(v.A,{children:(0,G.jsx)(f.A,{colSpan:12,align:"center",children:(0,G.jsx)(a.A,{variant:"body1",color:"textSecondary",children:"No issues found"})})}):$.slice(10*re,10*(re+1)).map((e=>{var t,s,l,r,d,u,h,A,x,j;return(0,G.jsxs)(v.A,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,G.jsx)(f.A,{children:e.key||"N/A"}),(0,G.jsx)(f.A,{children:e.type&&K[e.type]?(0,G.jsx)(n.A,{title:K[e.type].label,children:(0,G.jsx)(S.A,{size:"small",color:K[e.type].color,children:K[e.type].icon})}):(0,G.jsx)(S.A,{size:"small",disabled:!0,children:(0,G.jsx)(k.A,{})})}),(0,G.jsx)(f.A,{children:e.title||"Untitled"}),(0,G.jsx)(f.A,{children:e.priority&&Y[e.priority]?(0,G.jsx)(o.A,{size:"small",label:Y[e.priority].label,color:Y[e.priority].color,icon:(0,G.jsx)("span",{children:Y[e.priority].icon})}):(0,G.jsx)(o.A,{size:"small",label:"None",color:"default"})}),(0,G.jsx)(f.A,{children:(0,G.jsxs)(p.A,{value:e.status,onChange:t=>Ue(e._id,t.target.value),children:[(0,G.jsx)(g.A,{value:Q,children:Z[Q]}),(0,G.jsx)(g.A,{value:V,children:Z[V]}),(0,G.jsx)(g.A,{value:X,children:Z[X]})]})}),(0,G.jsx)(f.A,{children:e.assignee?(0,G.jsx)(n.A,{title:(null===(t=Ee(e.assignee))||void 0===t?void 0:t.email)||"Unknown",children:(0,G.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[console.log("Assignee ID:",e.assignee),console.log("Assignee User:",Ee(e.assignee)),(0,G.jsx)(c.A,{sx:{width:24,height:24,mr:1},alt:(null===(s=Ee(e.assignee))||void 0===s?void 0:s.email)||"Unknown",children:(null===(l=Ee(e.assignee))||void 0===l||null===(r=l.email)||void 0===r?void 0:r.charAt(0))||"?"}),(0,G.jsx)(a.A,{variant:"body2",children:(null===(d=Ee(e.assignee))||void 0===d?void 0:d.email)||"Unknown"})]})}):(0,G.jsx)(n.A,{title:"Unassigned",children:(0,G.jsx)(c.A,{sx:{width:24,height:24},children:"?"})})}),(0,G.jsx)(f.A,{children:e.reporter?(0,G.jsx)(n.A,{title:(null===(u=Ee(e.reporter))||void 0===u?void 0:u.email)||"Unknown",children:(0,G.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[console.log("Reporter ID:",e.reporter),console.log("Reporter User:",Ee(e.reporter)),(0,G.jsx)(c.A,{sx:{width:24,height:24,mr:1},alt:(null===(h=Ee(e.reporter))||void 0===h?void 0:h.email)||"Unknown",children:(null===(A=Ee(e.reporter))||void 0===A||null===(x=A.email)||void 0===x?void 0:x.charAt(0))||"?"}),(0,G.jsx)(a.A,{variant:"body2",children:(null===(j=Ee(e.reporter))||void 0===j?void 0:j.email)||"Unknown"})]})}):(0,G.jsx)(n.A,{title:"No Reporter",children:(0,G.jsx)(c.A,{sx:{width:24,height:24},children:"?"})})}),(0,G.jsx)(f.A,{children:e.storyPoints||"-"}),(0,G.jsx)(f.A,{children:e.dueDate?(0,U.GP)(new Date(e.dueDate),"MMM d, yyyy"):"-"}),(0,G.jsx)(f.A,{children:e.createdAt?(0,U.GP)(new Date(e.createdAt),"MMM d, yyyy"):"N/A"}),(0,G.jsx)(f.A,{children:!_e&&(0,G.jsx)(S.A,{onClick:t=>{we(t.currentTarget),Pe(e)},size:"small",children:(0,G.jsx)(_.A,{})})})]},e._id)}))})]})}):(0,G.jsx)(H.Q,{backend:N.t2,children:(0,G.jsxs)(i.A,{sx:{display:"flex",gap:3,mt:3,px:2,minHeight:"calc(100vh - 200px)",bgcolor:"#f3f4f6",borderRadius:2,p:3},children:[(0,G.jsx)(Be,{status:Q,issues:$.filter((e=>e.status===Q))}),(0,G.jsx)(Be,{status:V,issues:$.filter((e=>e.status===V))}),(0,G.jsx)(Be,{status:X,issues:$.filter((e=>e.status===X))})]})}),(0,G.jsx)(P.A,{rowsPerPageOptions:[5,10,25],component:"div",count:$.length,rowsPerPage:10,page:re,onPageChange:(e,t)=>ie(t),onRowsPerPageChange:e=>{setRowsPerPage(parseInt(e.target.value,10)),ie(0)}}),(0,G.jsxs)(C.A,{anchorEl:be,open:Boolean(be),onClose:()=>{we(null),Pe(null)},children:[(0,G.jsxs)(g.A,{onClick:()=>{Ce("/issues/edit/".concat(null===Se||void 0===Se?void 0:Se._id)),we(null),Pe(null)},children:[(0,G.jsx)(I.A,{children:(0,G.jsx)(E.A,{fontSize:"small"})}),"Edit"]}),(0,G.jsxs)(g.A,{onClick:async()=>{if(window.confirm("Are you sure you want to delete this issue?"))try{await z.A.remove(null===Se||void 0===Se?void 0:Se._id);(async()=>{le(!0);try{const[e,t,l]=await Promise.all([B.A.getAll(),z.A.getAll(),L.A.getAll()]);fe(l.data),je(e.data),s(t.data);const r=t.data.filter((e=>"epic"===e.type));ye(r);const i=Re(t.data);te(i)}catch(e){console.error("Error fetching data:",e)}finally{le(!1)}})()}catch(e){console.error("Error deleting issue:",e)}we(null),Pe(null)},children:[(0,G.jsx)(I.A,{children:(0,G.jsx)(R.A,{fontSize:"small"})}),"Delete"]})]})]})}},94160:(e,t,s)=>{s.d(t,{A:()=>r});var l=s(50214);const r={getAll:()=>l.A.get("/issues"),getById:e=>l.A.get("/issues/".concat(e)),getByProject:e=>l.A.get("/issues/project/".concat(e)),getByEpic:e=>l.A.get("/issues/epic/".concat(e)),getBySprint:e=>l.A.get("/issues/sprint/".concat(e)),create:e=>l.A.post("/issues",e),update:(e,t)=>{const s=(e=>{var t,s,l;const r={title:null===(t=e.title)||void 0===t?void 0:t.trim(),description:null===(s=e.description)||void 0===s?void 0:s.trim(),status:(null===(l=e.status)||void 0===l?void 0:l.toLowerCase())||"to do",priority:(e.priority||"medium").toLowerCase(),startDate:e.startDate||void 0,dueDate:e.dueDate||void 0,owner:e.owner||localStorage.getItem("userId"),assignee:e.assignee||null,watchers:e.watchers||[]};return void 0!==e.project&&(r.project=e.project||null),Object.keys(r).forEach((e=>{void 0===r[e]&&delete r[e]})),console.log("Original issue data:",e),console.log("Transformed issue data:",r),r})(t);return console.log("Transformed update data:",s),l.A.put("/issues/".concat(e),s)},remove:e=>l.A.delete("/issues/".concat(e)),addComment:(e,t)=>l.A.post("/issues/".concat(e,"/comments"),t),addAttachment:(e,t)=>{const s=new FormData;return s.append("attachment",t),l.A.post("/issues/".concat(e,"/attachments"),s,{headers:{"Content-Type":"multipart/form-data"}})},updateTimeTracking:(e,t)=>l.A.post("/issues/".concat(e,"/timetracking"),t)}},11046:(e,t,s)=>{s.d(t,{A:()=>r});var l=s(50214);const r={getAll:()=>l.A.get("/projects"),get:e=>l.A.get("/projects/".concat(e)),create:e=>l.A.post("/projects",e),update:(e,t)=>l.A.put("/projects/".concat(e),t),remove:e=>l.A.delete("/projects/".concat(e)),removeAll:()=>l.A.delete("/projects"),findByTitle:e=>l.A.get("/projects?title=".concat(e)),getProjectProgress:e=>l.A.get("/projects/".concat(e,"/progress")),getBudgetAnalytics:e=>l.A.get("/projects/".concat(e,"/budget-analytics")),getTeamPerformance:e=>l.A.get("/projects/".concat(e,"/team-performance")),searchProjects:e=>l.A.post("/projects/search",e),getProjectMessages:e=>l.A.get("/projects/".concat(e,"/messages")),sendProjectMessage:(e,t)=>l.A.post("/projects/".concat(e,"/messages"),t),exportProjectReport:(e,t)=>l.A.get("/projects/".concat(e,"/export/").concat(t)),scheduleReport:(e,t)=>l.A.post("/projects/".concat(e,"/schedule-report"),t),getProjectAnalytics:e=>l.A.get("/projects/".concat(e,"/analytics")),getProjectById:e=>l.A.get("/projects/id/".concat(e)),findByTeams:e=>l.A.get("/projects/teams/".concat(e))}}}]);
//# sourceMappingURL=57.54882f56.chunk.js.map